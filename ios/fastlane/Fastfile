default_platform(:ios)

platform :ios do
  desc "Build and archive iOS app"
  lane :build do
    # Setup code signing
    setup_ci if is_ci
    
    # Debug: List files in current directory
    sh("ls -la")
    
    # Build the app with manual xcodebuild commands
    sh("xcodebuild -workspace ./Runner.xcworkspace -scheme Runner -configuration Release -archivePath ./build/Runner.xcarchive clean archive -allowProvisioningUpdates -sdk iphoneos -destination 'generic/platform=iOS' -allowProvisioningDeviceRegistration")
    
    # Export the archive
    sh("xcodebuild -exportArchive -archivePath ./build/Runner.xcarchive -exportOptionsPlist ./exportOptions.plist -exportPath ./build/ios -allowProvisioningUpdates")
  end
end